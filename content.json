{"pages":[{"title":"about~~~~","text":"","link":"/about/about.html"},{"title":"categories","text":"","link":"/categories/index.html"},{"title":"tags","text":"","link":"/tags/index.html"}],"posts":[{"title":"useCallbackä½¿ç”¨åœºæ™¯è¯´æ˜å’Œä¸¾ğŸŒ°","text":"useCallback ä½¿ç”¨åœºæ™¯è¯´æ˜å’Œä¸¾æ — ä½¿ç”¨ react hooks æ—¶, çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’å‡½æ•° æˆ– åœ¨ useEffect ä¸­ä½¿ç”¨å¤–éƒ¨å‡½æ•°, å¦‚æœä¸åšä»»ä½•å¤„ç†ä¼šå‡ºç° ç»„ä»¶é‡å¤æ¸²æŸ“ æˆ– useEffect ä¸­çš„é€»è¾‘è¢«ä¸åœè§¦å‘çš„æƒ…å†µ, ä¸€èˆ¬è¿™ä¸ªæ—¶å€™ react-hooks çš„ lint ä¹Ÿä¼šæŠ¥é”™ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ useCallback æ¥å°†åŸå‡½æ•°åŒ…è£…ä¸€å±‚å†ä¼ åˆ°éœ€è¦ç”¨çš„åœ°æ–¹, é¿å…å¼‚å¸¸æƒ…å†µã€‚ æœ¬æ–‡ä»‹ç»äº†ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ useCallback, useCallback å¦‚ä½•å’Œ React.memo() é…åˆä½¿ç”¨, å¹¶é™„ä¸Šç¤ºä¾‹ä»£ç åŠgifæˆªå±, æ–¹ä¾¿æ›´ç›´è§‚çš„ç†è§£ã€‚ &lt;!â€”moreâ€”&gt; åŸºæœ¬ç”¨æ³•æŠŠä½ è¦çš„å‡½æ•°ç”¨ useCallback åŒ…ä¸€å±‚, å®šä¹‰å¥½åªæœ‰ä»€ä¹ˆå‚æ•°å˜åŒ–æ—¶, è¿™ä¸ªè¢«åŒ…è¿‡çš„å‡½æ•°æ‰éœ€è¦æ›´æ–° 123456789const yourfunc = useCallback( () =&gt; { // ä½ è¦å†™çš„å‡½æ•°é€»è¾‘ }, [ // åœ¨æ•°ç»„é‡Œå®šä¹‰ä»€ä¹ˆå‚æ•°æ”¹å˜æ—¶æ‰éœ€è¦æ›´æ–° yourfunc, // åªè¦è¿™é‡Œçš„ä¾èµ–çš„å‚æ•°æ²¡æœ‰å˜å¯¹äºä»»ä½•ä½¿ç”¨å®ƒçš„ä¸€æ–¹å®ƒéƒ½æ²¡æœ‰å˜ ]) ä½¿ç”¨åœºæ™¯ çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’å‡½æ•°æ—¶, é˜»æ­¢ä¼ é€’çš„å‡½æ•°åœ¨æ¯æ¬¡ render æ—¶é‡æ–°åˆ›å»ºï¼Œä»è€Œé€ æˆå­ç»„ä»¶ rerenderã€‚éœ€è¦é…åˆ React.memo() ä¸€èµ·ä½¿ç”¨ã€‚ åœ¨ useEffectï¼ˆï¼‰ ä¸­ä½¿ç”¨å¤–éƒ¨åˆ›å»ºçš„å‡½æ•°, ä½†ä¸å¸Œæœ›è¿™ä¸ªå‡½æ•°ä¸€ç›´å˜åŒ–, å¯¼è‡´ useEffect è¢«é‡å¤è§¦å‘ã€‚ æ —å­ğŸŒ° çˆ¶ç»„ä»¶ä¼ é€’å‡½æ•°ç»™å­ç»„ä»¶ ä½¿ç”¨ useCallback å‰ï¼Œçˆ¶ç»„ä»¶ç›´æ¥ä¼ å‡½æ•°ç»™å­ç»„ä»¶çš„æ–¹å¼ã€‚æ¯æ¬¡ app render æ—¶, ä¼ é€’çš„å‡½æ•° () =&gt; setCount(count + 1) éƒ½ä¼šé‡æ–°åˆ›å»ºä¸€æ¬¡ã€‚æ¯æ¬¡ç‚¹å‡» hello æŒ‰é’®ï¼Œéƒ½ä¼šè¿›è¡Œ renderã€‚ ä¸Šå›¾ log æ˜¯æ‰“åœ¨å­ç»„ä»¶ &lt;Hello \u0010/&gt; ä¸­çš„, ä»logå¯ä»¥çœ‹åˆ°, æ¯æ¬¡ç‚¹å‡»æŒ‰é’®éƒ½ä¼šé€ æˆå­ç»„ä»¶ rerenderã€‚ ä½¿ç”¨ useCallback å‰çš„çˆ¶ç»„ä»¶ 1234567891011121314import React, { useState } from 'react'import { Hello } from './hello'export default function Counter() { const [count, setCount] = useState(0) // éœ€è¦æ³¨æ„, æ¯æ¬¡ render ä¼ é€’çš„å‡½æ•°éƒ½ä¼šé‡æ–°ç”Ÿæˆ // ä¹Ÿå°±æ˜¯ä¸‹é¢çš„ () =&gt; setCount(count + 1) return ( &lt;div&gt; &lt;Hello increment={() =&gt; setCount(count + 1)} /&gt; &lt;div&gt;count: {count}&lt;/div&gt; &lt;/div&gt; )} å­ç»„ä»¶å­ç»„ä»¶ä¸­ React.memo() çš„ä½œç”¨ç±»ä¼¼äº class ç»„ä»¶ä¸­çš„ shouldComponentUpdate, ä¼šå¯¹ç»„ä»¶æ¥å—åˆ°çš„ propsè¿›è¡Œæµ…æ¯”è¾ƒ, å¦‚æœ props æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶å°±ä¸ä¼š rerender. å¦‚æœè¿™é‡ŒæŠŠ React.memo() å»æ‰, é‚£å³ä½¿çˆ¶ç»„ä»¶ä½¿ç”¨ useCallback æ”¹å†™ã€‚å­ç»„ä»¶ è¿˜æ˜¯ä¼š rerenderã€‚ 1234567891011import React, { useRef } from 'react'// ä½¿ç”¨ React.memo ä½¿ç»„ä»¶ä»…åœ¨ props æ›´æ–°æ—¶æ›´æ–°// æœªä½¿ç”¨ useCallback æ—¶, ç”±äºæ¯æ¬¡ä¼ é€’è¿‡æ¥çš„ increment æ¥åˆ°çš„å‡½æ•°éƒ½ä¼šæ›´æ–°, å­ç»„ä»¶æ¯æ¬¡éƒ½ä¼šrerenderexport const Hello = React.memo(({ increment }) =&gt; { // ä¸‹é¢ä¸¤å¥ç”¨æ¥æŸ¥çœ‹ç»„ä»¶æ›´æ–°çš„æ¬¡æ•° const renderCount = useRef(0) console.log('render count:', renderCount.current++) return &lt;button onClick={increment}&gt;hello&lt;/button&gt;}) ä½¿ç”¨ useCallback æ”¹å†™çˆ¶ç»„ä»¶å, æ¯æ¬¡æ›´æ–°æ•°æ®ç»„ä»¶ä¸å†é‡æ–°æ¸²æŸ“, å¦‚å›¾ ä½¿ç”¨ useCallback æ”¹å†™åŸçˆ¶ç»„ä»¶, å­ç»„ä»¶ä¸éœ€è¦ä¿®æ”¹1234567891011121314151617181920import React, { useState, useCallback } from 'react'import { Hello } from './hello'export default function Counter() { const [count, setCount] = useState(0) // useCallback ä»…å°† setCount ä½œä¸ºä¾èµ–, åªè¦ setCount ä¸æ”¹å˜, // increment å‡½æ•°å°±ä¸ä¼šæ”¹å˜ // ç›¸åº”çš„å­ç»„ä»¶æ¥å—åˆ°çš„ props æ²¡æ”¹å˜, å°±ä¸ä¼š rerender const increment = useCallback(() =&gt; { setCount(prevCount =&gt; prevCount + 1) }, [setCount]) return ( &lt;div&gt; &lt;Hello increment={increment} /&gt; &lt;div&gt;count: {count}&lt;/div&gt; &lt;/div&gt; )} ä½¿ç”¨ map æ¸²æŸ“å¤šä¸ªå­ç»„ä»¶å¹¶ä¼ é€’å‡½æ•°ç»™å®ƒä»¬ ä¸‹é¢çš„è®¡æ•°å™¨å°†ä¸€ä¸ªæ•°å­—æ„æˆçš„æ•°ç»„æ¸²æŸ“æˆå¤šä¸ªæŒ‰é’®, ç‚¹å‡»æŒ‰é’®ç»™ count å¢åŠ ç›¸åº”çš„å€¼ã€‚ä¸ä¸Šé¢çš„ä¾‹å­ä¸åŒçš„æ˜¯, è¿™é‡Œçš„ increment éœ€è¦ä¼ å…¥å¯¹åº”çš„æ•°å­—, è¿›è¡Œç›¸åº”è®¡æ•°ã€‚æ”¾ä¸Šè¿™ä¸ªä¾‹å­æ˜¯ä¸ºäº†è¯´æ˜, å¦‚æœ å­ç»„ä»¶è¦æ‰§è¡Œçš„å‡½æ•° å’Œ å‡½æ•°è¦ç”¨åˆ°çš„å‚æ•° éƒ½æ˜¯çˆ¶ç»„ä»¶æä¾›çš„, æœ€å¥½æŠŠäºŒè€…éƒ½ä¼ é€’ç»™å­ç»„ä»¶åœ¨å­ç»„ä»¶æ‰§è¡Œã€‚ æ”¹å†™å‰ç‚¹å‡»è®¡æ•°æˆªå›¾ ä¼šé€ æˆ rerender çš„çˆ¶ç»„ä»¶å‡½æ•°ä¼ é€’æ–¹å¼ 12345678910111213141516171819202122232425262728import React, { useState, useCallback } from 'react'import { Num } from './numbers'export default function Counter() { const [count, setCount] = useState(0) const nums = [3, 33, 333] const increment = useCallback(n =&gt; { setCount(prevCount =&gt; prevCount + n) }, [setCount]) // ä¼ é€’ () =&gt; increment(n), è€Œä¸æ˜¯ç›´æ¥ä¼ é€’ increment // ä»ç„¶ä¼šé€ æˆæ¯æ¬¡ render ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•° return ( &lt;div&gt; { nums.map(n =&gt; &lt;Num onClick={() =&gt; increment(n)} n={n} key={n} /&gt; ) } &lt;div&gt;count: {count}&lt;/div&gt; &lt;/div&gt; )} ç›¸åº”çš„å­ç»„ä»¶ç›´æ¥è°ƒç”¨ onClick 123456789import React, { useRef } from 'react'export const Num = React.memo(({ onClick, n }) =&gt; { // ä»¥ä¸‹ä¸¤å¥ç”¨æ¥æŸ¥çœ‹ç»„ä»¶æ›´æ–°çš„æ¬¡æ•° const renderCount = useRef(0) console.log('render count:', renderCount.current++) return &lt;button onClick={onClick}&gt;{n}&lt;/button&gt;}) æ”¹å†™åç‚¹å‡»è®¡æ•°æˆªå›¾ æ”¹å†™åçš„ çˆ¶ç»„ä»¶1234567891011121314151617181920212223242526import React, { useState, useCallback } from 'react'import { Num } from './numbers'export default function Counter() { const [count, setCount] = useState(0) const nums = [3, 33, 333] const increment = useCallback(n =&gt; { setCount(prevCount =&gt; prevCount + n) }, [setCount]) return ( &lt;div&gt; { nums.map(n =&gt; &lt;Num increment={increment} n={n} key={n} /&gt; ) } &lt;div&gt;count: {count}&lt;/div&gt; &lt;/div&gt; )} æ”¹å†™åçš„å­ç»„ä»¶ 1234567export const Num = React.memo(({ increment, n }) =&gt; { // ä»¥ä¸‹ä¸¤å¥ç”¨æ¥æŸ¥çœ‹ç»„ä»¶æ›´æ–°çš„æ¬¡æ•° const renderCount = useRef(0) console.log('render count:', renderCount.current++) return &lt;button onClick={() =&gt; {increment(n)}}&gt;{n}&lt;/button&gt;})","link":"/2020/01/13/useCallbackä½¿ç”¨åœºæ™¯/"}],"tags":[],"categories":[{"name":"JavaScript","slug":"JavaScript","link":"/categories/JavaScript/"}]}